<!DOCTYPE html>
<!-- Server: sfn-web-12 -->


  










<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]>--> <html lang="en" class="no-js"> <!--<![endif]-->
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type"/>
    <title>Whonix / Documentation / Design-Shared</title>
    

<script src="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/js/sftheme/modernizr.custom.90514.js"></script>

<script src="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/js/sftheme/jquery-1.8.0.min.js"></script>

<script src="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/js/sftheme/header.js"></script>
<!--[if lt IE 7 ]>
  <script src="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/js/sftheme/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg'); //fix any <img> or .png_bg background-images </script>
<![endif]-->
<link href='//fonts.googleapis.com/css?family=Ubuntu:regular' rel='stylesheet' type='text/css'>
<style type="text/css">
    @font-face {
        font-family: "Pictos";
        src: url('http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/fonts/sftheme/pictos-web.eot');
        src: local("â˜º"), url('http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/fonts/sftheme/pictos-web.woff') format('woff'), url('http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/fonts/sftheme/pictos-web.ttf') format('truetype'), url('http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/fonts/sftheme/pictos-web.svg') format('svg');
    }
</style>
    <script type="text/javascript">
            /*jslint onevar: false, nomen: false, evil: true, css: true, plusplus: false, white: false, forin: true, on: true, immed: false */
            /*global confirm, alert, unescape, window, jQuery, $, net, COMSCORE */
    </script>
    
      <!-- ew:head_css -->

    
      <link rel="stylesheet"
                type="text/css"
                href="http://a.fsdn.com/allura/nf/1364319766/_ew_/allura/css/forge/hilite.css"
                >
    
      <link rel="stylesheet"
                type="text/css"
                href="http://a.fsdn.com/allura/nf/1364319766/_ew_/tool/wiki/css/wiki.css"
                >
    
      <link rel="stylesheet"
                type="text/css"
                href="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/forge.css"
                >
    
      <link rel="stylesheet"
                type="text/css"
                href="http://a.fsdn.com/allura/nf/1364319766/_ew_/_slim/css?href=css%2Fmarkitup_sf.css%3Bcss%2Fpage_list.css%3Bcss%2Fjquery.tagsinput.css"
                >
    
      
<!-- /ew:head_css -->

    
    
    
      <!-- ew:head_js -->

    
      
<!-- /ew:head_js -->

    
    

    
      <style type="text/css">
        #page-body.project---init-- #top_nav { display: none; }
#page-body.project---init-- #nav_menu_holder { display: none; margin-bottom: 0; }
#page-body.project---init-- #content_base {margin-top: 0; }
      </style>
    
    
<style>
  .hidden { display: none }
  a.notfound { color: #f00; }
</style>

      <style>.XAsBhZsqYlcjtZTeiJZzIfU { display:none }</style>

    
<link rel="alternate" type="application/rss+xml" title="Page RSS" href="feed.rss"/>
<link rel="alternate" type="application/atom+xml" title="Page Atom" href="feed.atom"/>
<link rel="alternate" type="application/rss+xml" title="Wiki RSS" href="../feed.rss"/>
<link rel="alternate" type="application/atom+xml" title="Wiki Atom" href="../feed.atom"/>

    
    


<script type="text/javascript">
    var _gaq = _gaq || [];

    function _add_tracking(prefix, tracking_id, send_user) {
        _gaq.push([prefix+'._setAccount', tracking_id]);
        _gaq.push([prefix+'._setCustomVar', 1, 'Page Type', 'wiki', 3]);_gaq.push([prefix+'._trackPageview']);
    }
      _add_tracking('sfnt1', 'UA-32013-6', true);
      _add_tracking('sfnt2', 'UA-36130941-1', true);
    

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' === document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </head>

  <body class="wiki-Design-Shared" id="forge">
    
      <!-- ew:body_top_js -->

    
      
<!-- /ew:body_top_js -->

    
    
<header id="site-header">
    <div class="wrapper">
        <a href="/" class="logo">
            <span>SourceForge</span>
        </a>
        
        <form method="get" action="/directory/">
            <input type="text" id="words" name="q" placeholder="Search">
        </form>
        
        <!--Switch to {language}-->
        <nav id="nav-site">
            <a href="/directory/" title="Browse our software.">Browse</a>
            <a href="/directory/enterprise" title="Browse our Enterprise software.">Enterprise</a>
            <a href="/blog/" title="Read the latest news from the SF HQ.">Blog</a>
            <a href="/support" title="Contact us for help and feedback.">Help</a>
            <a href="/jobs?source=header" title="Search 80k+ tech jobs." class="featured-link">Jobs</a>
        </nav>
        <nav id="nav-account">
            
              <div class="logged_out">
                <a href="/account/login.php">Log In</a>
                <span>or</span>
                <a href="https://sourceforge.net/user/registration/">Join</a>
              </div>
            
        </nav>
        
    </div>
</header>
<header id="site-sec-header">
    <div class="wrapper">
        <nav id="nav-hubs">
            <h4>Solution Centers</h4>
            <a href="http://ibmsmartercommerce.sourceforge.net/">Smarter Commerce</a>
            <a href="http://goparallel.sourceforge.net/">Go Parallel</a>
            <a href="http://html5center.sourceforge.net/">HTML5</a>
            <a href="http://ibmsmarteritservices.sourceforge.net/">Smarter IT</a>
        </nav>
        <nav id="nav-collateral">
            <a href="http://library.geeknetmedia.com">Resources</a>
            
            <a href="">Newsletters</a>
            
        </nav>
    </div>
</header>
    
    <section id="page-body" class=" neighborhood-Projects project-whonix mountpoint-wiki">
	  <div class="grid-24" id="nav_menu_holder">
            
            


  
  <a href="/p/whonix/">
    
      <img src="/p/whonix//icon?2012-10-18 23:06:52+00:00" class="project_icon" alt="Project Logo">
    
	<h1 class="project_title">
      
        Whonix
      
	</h1>
	</a>

            
      </div>
      <div id="top_nav" class="">
        
        
  
    <a href="/p/whonix/homelink/" class="ui-icon-tool-link">
      Homepage
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/wiki/" class="ui-icon-tool-wiki">
      Documentation
      
        
          <span class="diamond"></span>
        
      
      
      
    </a>
	
    <a href="/p/whonix/blog/" class="ui-icon-tool-blog">
      Important Blog
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/featureblog/" class="ui-icon-tool-blog">
      Feature Blog
      
        
      
      
      
    </a>
	
    <a href="/projects/whonix/files/" class="ui-icon-tool-files">
      _
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/discussion/" class="ui-icon-tool-discussion">
      User Help Forum
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/mailman/" class="ui-icon-tool-mailman">
      Developer Mailing List
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/code/" class="ui-icon-tool-git">
      Source Code
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/donate/" class="ui-icon-tool-link">
      Donate
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/awiki/" class="ui-icon-tool-wiki">
      _
      
        
      
      
      
    </a>
	
	<div style="clear:both"></div>

        
      </div>
      <div id="content_base">
			  
          
        
			  
          
        
        <div class="grid-24 pad">
          <h2 class="dark title">Design-Shared
            <!-- actions -->
            <small>
            
  
    
    <a href="history" title="History"><b data-icon="N" class="ico ico-history" title="History"></b></a>
  
  
	<a href="feed" title="RSS"><b data-icon="f" class="ico ico-feed" title="Feed"></b></a>
  <a href="../search" title="Search"><b data-icon="s" class="ico ico-search" title="Search"></b></a>

            </small>
            <!-- /actions -->
          </h2>
		
  

          <div>
            
            
  
<div class="markdown_content"><div>
<div class="markdown_content"><p><a class="" href="https://sourceforge.net/p/whonix/wiki/Home/#whonix-homepage">Whonix Homepage</a> | <img alt="" src="http://whonix.sourceforge.net/screenshots/BC_Rnd_32px.png" /> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Contribute/#donate">Donate</a></p>
<p><a class="" href="https://sourceforge.net/p/whonix/wiki/Download/#stay-tuned">News</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Screenshots/">Screenshots</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Videos/">Videos</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Download/">Download</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Documentation/">Documentation</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/About/">About</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Features/">Features</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Security%20Guide/">Security Guide</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/FAQ/">FAQ</a> | <a class="" href="https://sourceforge.net/p/whonix/discussion/">Forum</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Contact/">Contact</a></p>
<p><a class="" href="https://sourceforge.net/p/whonix/wiki/Bridges/">Bridges Support</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Features/#vpn-tunnel-support">VPN/Tunnel Support</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/HostingLocationHiddenServers/">Location/IP Hidden Servers</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/OtherOperatingSystems/">Windows Support</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/BrowserPlugins/">Flash Support</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Contribute/">You Can Help</a></p>
<p><a class="" href="https://sourceforge.net/p/whonix/wiki/Contribute/">Contribiute</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Design/">Tech. Design</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Dev_SourceCode/">Source Code / Hacking / Development Tickets</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Changelog/">Changelog</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Authorship/">Authorship</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Authorship/#disclaimer">Disclaimer</a></p>
<p><font size="-3">This is a wiki. Want to improve this page? Contact us!</font></p></div>
</div>
<div class="toc">
<ul>
<li><a href="#get-build-dependencies">Get Build Dependencies</a></li>
<li><a href="#get-base-operating-system">Get Base Operating System</a></li>
<li><a href="#backup-base-operating-system">Backup Base Operating System</a></li>
<li><a href="#mount-image">Mount Image</a></li>
<li><a href="#copy-files-into-image">Copy Files Into Image</a></li>
<li><a href="#chrooting">Chrooting</a></li>
<li><a href="#running-scripts-inside-chroot">Running Scripts inside Chroot</a></li>
<li><a href="#unchrooting">Unchrooting</a></li>
<li><a href="#unmounting">Unmounting</a></li>
<li><a href="#creating-a-virtual-machine-package">Creating a Virtual Machine package</a></li>
<li><a href="#files">Files</a><ul>
<li><a href="#essential">Essential</a><ul>
<li><a href="#username-fqdn-hostname">Username, FQDN, hostname</a></li>
<li><a href="#operating-system-updates">Operating System Updates</a></li>
<li><a href="#timesync">TimeSync</a></li>
<li><a href="#banned-packages">Banned Packages</a></li>
<li><a href="#stream-isolation-wrapper">Stream Isolation Wrapper</a></li>
</ul>
</li>
<li><a href="#extra">Extra</a><ul>
<li><a href="#hdd-configuration-swap-disk-uuid-dbus-machine-id">hdd configuration / swap / Disk uuid / dbus machine-id</a></li>
<li><a href="#base-files">Base Files</a></li>
</ul>
</li>
<li><a href="#usability">Usability</a><ul>
<li><a href="#check-mechanism">check mechanism</a></li>
<li><a href="#sudoers">sudoers</a></li>
<li><a href="#console-autologin">Console Autologin</a></li>
<li><a href="#console-default-password-hint">Console Default Password Hint</a></li>
<li><a href="#console-welcome-message">Console Welcome Message</a></li>
<li><a href="#deactivate-display-power-saving-in-virtual-machines">Deactivate display power saving in Virtual Machines</a></li>
<li><a href="#boot-manager-configuration">boot manager configuration</a></li>
<li><a href="#update-command-not-found">update command not found</a></li>
<li><a href="#securessl-command-line-downloader">Secure/SSL Command Line Downloader</a></li>
<li><a href="#slim-down">Slim Down</a></li>
<li><a href="#icons">Icons</a></li>
</ul>
</li>
<li><a href="#debugging">Debugging</a><ul>
<li><a href="#sanity-checks">Sanity Checks</a></li>
<li><a href="#variables">Variables</a></li>
<li><a href="#package-cache">Package Cache</a></li>
<li><a href="#prevent-daemons-from-starting-inside-chroot">Prevent daemons from starting inside chroot</a></li>
<li><a href="#indicate-last-chroot-script">Indicate last chroot script</a></li>
<li><a href="#lower-priority-while-building">Lower priority while building</a></li>
<li><a href="#enable-debugging">Enable debugging</a></li>
<li><a href="#error-handling">Error handling</a></li>
<li><a href="#delete-virtual-machine-files">Delete Virtual Machine files</a></li>
<li><a href="#interactive-chroot">Interactive Chroot</a></li>
</ul>
</li>
<li><a href="#licensing">Licensing</a></li>
</ul>
</li>
<li><a href="#build-automation">Build Automation</a></li>
<li><a href="#release-automation">Release Automation</a></li>
<li><a href="#other-important-things">Other important things</a></li>
<li><a href="#footer">Footer</a></li>
</ul>
</div>
<h1 id="get-build-dependencies">Get Build Dependencies</h1>
<p>Install a tool to create Virtual Machine images (such as grml-debootstrap) and tools for mouting and apply other useful build configurations.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>Configure apt-get and dpkg, to ask no questions while installing the build dependencies.</li>
<li>Update the build machine's operating system.</li>
<li>Configure apt-cacher-ng to speed up downloading when building multiple times (for debugging).</li>
<li>Install tools used in the build process.<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/15_prepare-build-machine" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/15_prepare-build-machine</a></li>
</ul>
</li>
</ul>
<h1 id="get-base-operating-system">Get Base Operating System</h1>
<p>Use a tool to create a Virtual Machine base installation, which contains a secure operating system and which is bootable.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>Used Debian for reasons explained on the <a class="alink" href="/p/whonix/wiki/OperatingSystem/">[OperatingSystem]</a> design page.</li>
<li>Whonix uses grml-debootstrap to build .img Virtual Machine images. The .img images are still virtualizer agnostic, can be run in a variety of virtualizers such as Qemu or Qubes OS. They can (and will in Whonix-Example-Implementation case) be converted to other formats to support other virtualizers (such as the .img format, which Virtual Box uses in case of Whonix).<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/20_create-debian-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/20_create-debian-img</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/Whonix-Gateway_packages" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/Whonix-Gateway_packages</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/Whonix-Workstation_packages" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/Whonix-Workstation_packages</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/grml_config" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/grml_config</a></li>
</ul>
</li>
</ul>
<p>Other Implementations:</p>
<ul>
<li>Old Whonix versions up to 0.3.0 used Ubuntu as base operating system.</li>
<li>Old Whonix versions up to 0.3.0 used <a class="" href="https://en.wikipedia.org/wiki/Preseed" rel="nofollow">Preseed</a>, installed the operating system from DVD inside a Virtual Machine.</li>
<li>This step can also be done manually, i.e. the user could be told to manually install some operating system.</li>
<li>Whonix with <a class="alink" href="/p/whonix/wiki/PhysicalIsolation/">[PhysicalIsolation]</a>.</li>
</ul>
<h1 id="backup-base-operating-system">Backup Base Operating System</h1>
<p>Make a backup of that image. This is not strictly required, but you will want to modify that image often and want to start fresh often.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/25_backup-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/25_backup-img</a></li>
</ul>
<h1 id="mount-image">Mount Image</h1>
<p>Mount the image, so files can be copied into it.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/mount-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/mount-img</a></li>
</ul>
<h1 id="copy-files-into-image">Copy Files Into Image</h1>
<p>Copy configuration files and chroot scripts into the Virtual Machine image to transform it into a Gateway or Workstation. </p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/30_copy-into-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/30_copy-into-img</a></li>
<li>All files from whonix_gateway will get copied into Whonix-Gateway.</li>
<li>All files from whonix_workstation will get copied into Whonix-Workstation.</li>
<li>All files from whonix_shared will get copied into Whonix-Gateway and Whonix-Workstation.</li>
</ul>
<h1 id="chrooting">Chrooting</h1>
<p>As preparation for the next step, there must be a method to chroot the mounted image.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/chroot-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/chroot-img</a></li>
</ul>
<h1 id="running-scripts-inside-chroot">Running Scripts inside Chroot</h1>
<p>The base operating system has to be modified. Some scripts need to be executed inside the virtual machines. This is called running chroot scripts.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/35_run-chroot-scripts-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/35_run-chroot-scripts-img</a></li>
</ul>
<h1 id="unchrooting">Unchrooting</h1>
<p>The process of chrooting must be undone after the chroot scripts were executed.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/unchroot-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/unchroot-img</a></li>
</ul>
<h1 id="unmounting">Unmounting</h1>
<p>The image must be unmounted after the copying files into it or after chrooting, running chroot scripts and unchrooting.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/unmount-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/unmount-img</a></li>
</ul>
<h1 id="creating-a-virtual-machine-package">Creating a Virtual Machine package</h1>
<p>It's useful to deploy the Virtual Machine images through a package format, which makes it easy to import them for users.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>Uses Virtual Box.</li>
<li>Virtual Box does not support .img images, only .vdi (and others).<ul>
<li>Therefore the .img image has to be converted to .vdi.<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/40_convert-img-to-vdi" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/40_convert-img-to-vdi</a></li>
</ul>
</li>
<li>The next step is to create a virtual machine description file.<ul>
<li>After creating it, the Virtual Machine could be started.</li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/45_create-vbox-vm" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/45_create-vbox-vm</a></li>
</ul>
</li>
<li>An easy way to deploy Virtual Machine images is through the <a class="" href="https://en.wikipedia.org/wiki/Open_Virtualization_Format" rel="nofollow">Open Virtualization Format</a> format (.ova images)<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/50_export-vbox-vm" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/50_export-vbox-vm</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="files">Files</h1>
<h2 id="essential">Essential</h2>
<h3 id="username-fqdn-hostname">Username, FQDN, hostname</h3>
<p>Hosts file. Use non-identifying values for FQDN and hostname, because some applications may leak it. (Mixmaster is known to leak it.) Set FQDN to "host.localdomain" and set hostname to "host". <a class="" href="https://mailman.boum.org/pipermail/tails-dev/2013-January/002457.html" rel="nofollow">It's best when they are shared among anonymity focused distributions.</a></p>
<p>It's recommend to work as non-privileged user and not using one will get into usability trouble (desktop environments don't like running as root). For usability, consistency, defence in depth, name it "user". It's better to say non-saying operating system user account names and ideally share them among anonymity focused distributions since the user could accidentally leak it (ex: ssh).</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>
<p>Set FQDN to "host.localdomain" and set hostname to "host": <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/hosts" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/hosts</a></p>
</li>
<li>
<p>adding user account "user": <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/50_adduser-user" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/50_adduser-user</a></p>
</li>
<li>configuring hostname "host": <a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/20_create-debian-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/20_create-debian-img</a></li>
<li>Even though grml-debootstrap already creates /etc/hostname with content "host", it's useful for physical isolation users, who set up the wrong host while installing: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/hostname" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/hostname</a></li>
<li>More information about the shared user name "user": <a class="alink" href="/p/whonix/wiki/Whonix%27s%20Protocol-Leak-Protection%20and%20Fingerprinting-Protection/">[Whonix's Protocol-Leak-Protection and Fingerprinting-Protection]</a></li>
</ul>
<h3 id="operating-system-updates">Operating System Updates</h3>
<p>Configure the package manager.</p>
<p>Configure software repositories.</p>
<p>Do not use the default automatic updates mechanism and use higher timeouts. It's better to disable the operating system's default automatic update mechanism, because times of automatic run are too predictable. The network fingerprint (not web fingerprint) could help an ISP guessing, that there is a network hidden operating system.</p>
<p>Notify about operating system updates in a safe way.</p>
<p>Misc settings, higher timeouts, more retries when package download or DNS resolution fails. This is useful because anonymity networks are slow and otherwise updating would occasionally fail due to network problems.</p>
<p>Must have a secure operating system updater (package manager), i.e. must not fall through the <a class="" href="https://www.updateframework.com/wiki/Docs/Security#AttacksandWeaknesses" rel="nofollow">TUF Threat Model</a> (<a class="" href="http://www.webcitation.org/6F7Io2ncN" rel="nofollow">w</a>). Additionally, downloading should go thought an anonymity network, with changing exit nodes. This makes an adversary less likely to interfere with the update process, because updates go through different ISPs, which makes it much more difficult to mount a man-in-the-middle attack over an extended amount of time.</p>
<p>The package manager shouldn't confuse the user with questions to keep the locally installed configuration file or to install the new version from the upstream package maintainer.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>Gateway and Workstation updates go through Tor. (Due to Firewall, Network Configuration and Stream Isolation Wrapper, details in Design-Shared/Gateway/Workstation.)</li>
<li>Whonix uses Debian ftp.us.debian.org and security.debian.org repositories. <ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/apt/sources.list" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/apt/sources.list</a></li>
</ul>
</li>
<li>Disable the operating system's default automatic update mechanism.<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/apt/apt.conf.d/20noperiodic" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/apt/apt.conf.d/20noperiodic</a></li>
</ul>
</li>
<li>Stop dpkg from asking questions whether new version of the Debian upstream package manager should be used. Always keep the old versions of configuration files to ensure, changes made by Whonix for privacy/anonymity won't get lost.<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/apt/apt.conf.d/20oldconfig" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/apt/apt.conf.d/20oldconfig</a> </li>
</ul>
</li>
<li>Higher timeouts, more retries.<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/apt/apt.conf.d/99timeout" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/apt/apt.conf.d/99timeout</a></li>
</ul>
</li>
<li>For the safe update notification, see check mechanism (whonixcheck) below.</li>
<li>Disable Apper (packagekit) automatic download of package lists (due to upstream bugs <a href="https://bugs.freedesktop.org/show_bug.cgi?id=62575" rel="nofollow"></a><a href="https://bugs.freedesktop.org/show_bug.cgi?id=62575" rel="nofollow"></a><a href="https://bugs.freedesktop.org/show_bug.cgi?id=62575" rel="nofollow">https://bugs.freedesktop.org/show_bug.cgi?id=62575</a> and <a href="https://bugs.freedesktop.org/show_bug.cgi?id=62576" rel="nofollow"></a><a href="https://bugs.freedesktop.org/show_bug.cgi?id=62576" rel="nofollow"></a><a href="https://bugs.freedesktop.org/show_bug.cgi?id=62576" rel="nofollow">https://bugs.freedesktop.org/show_bug.cgi?id=62576</a>)<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_workstation/usr/local/share/whonix/kde/share/config/apper" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_workstation/usr/local/share/whonix/kde/share/config/apper</a></li>
</ul>
</li>
</ul>
<h3 id="timesync">TimeSync</h3>
<p>Add a secure method with distributed trust to obtain date and time, because a clock which is drift, is bad for anonymity.</p>
<p>Whonix-Example-Implementation:</p>
<p>General Information</p>
<ul>
<li><a class="alink" href="/p/whonix/wiki/TimeSync/">[TimeSync]</a></li>
<li>tails_htp configuration file: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/default/htpdate" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/default/htpdate</a></li>
<li>When timesync is run by cron, it adds a random delay to prevent having a predictable network (not web) fingerprint. Essentially runs tails_htp every hour at a random time.</li>
</ul>
<p>Start Hooks</p>
<ul>
<li>tails_htp init script: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/init.d/htpdate" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/init.d/htpdate</a></li>
<li>Using cron to start it every hour: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/cron.hourly/htpdate" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/cron.hourly/htpdate</a></li>
<li>The file <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/htpdate_hourly" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/htpdate_hourly</a> gets run by <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/cron.hourly/htpdate" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/cron.hourly/htpdate</a> cron every hour.</li>
<li>Whonix-Gateway specific<ul>
<li>Auto start timesync status notification after (auto) login Whonix-Gateway: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/profile.d/10_timesync.sh" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/profile.d/10_timesync.sh</a></li>
</ul>
</li>
<li>Whonix-Workstation specific<ul>
<li>Auto start timesync status notification after (auto) login Whonix-Workstation: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_workstation/home/user/.config/autostart/timesync.desktop" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_workstation/home/user/.config/autostart/timesync.desktop</a></li>
</ul>
</li>
</ul>
<p>Install Hooks</p>
<ul>
<li>Adding tails_htp daemon user account and init script: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_htp" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_htp</a></li>
</ul>
<p>Supporting Files</p>
<ul>
<li>Allow Network Time Synchronization without password. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/sudoers.d/whonix" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/sudoers.d/whonix</a></li>
<li>Delay console output a bit when run after login. This ensures /etc/motd is shown earlier and introduces the status notifications gracefully. Better look and feel: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/delay" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/delay</a></li>
<li>Icon. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/icons/timesync.ico" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/icons/timesync.ico</a></li>
</ul>
<p>Script</p>
<ul>
<li>htpdate (tails_htp) itself: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/sbin/htpdate" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/sbin/htpdate</a></li>
<li>Combined graphical and text user interface "timesync" main script. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/timesync" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/timesync</a></li>
<li>Combined graphical and text user interface "timesync" scripts folder. <a href="https://github.com/adrelanos/Whonix/tree/development/whonix_shared/usr/local/bin/timesync-scripts" rel="nofollow">https://github.com/adrelanos/Whonix/tree/development/whonix_shared/usr/local/bin/timesync-scripts</a></li>
</ul>
<h3 id="banned-packages">Banned Packages</h3>
<p>Some packages aren't suited for an anonymous operating system. Reasons are privacy issues or messing with network settings. Ensure, that those get removed (if they got installed by the virtual machine image creation tool) and ensure that they won't get installed by accident.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_banned-packages" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_banned-packages</a></li>
</ul>
<h3 id="stream-isolation-wrapper">Stream Isolation Wrapper</h3>
<p>Stream isolate different applications to prevent identity correlation through circuit sharing. To my knowledge, only the anonymizer Tor supports this feature.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>See <a class="alink" href="/p/whonix/wiki/Stream%20Isolation/">[Stream Isolation]</a>.</li>
<li><a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/torsocks" rel="nofollow">uwt</a> is a wrapper arround torsocks. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/uwt" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/uwt</a></li>
<li>Application wrappers. (If the application isn't installed, the wrapper doesn't do anything. So having one more installed than necessary, doesn't matter.)<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/apt-get" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/apt-get</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/curl" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/curl</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/git" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/git</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/gpg" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/gpg</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/mixmaster-update" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/mixmaster-update</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/rawdog" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/rawdog</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/ssh" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/ssh</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/wget" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/wget</a></li>
</ul>
</li>
</ul>
<h2 id="extra">Extra</h2>
<h3 id="hdd-configuration-swap-disk-uuid-dbus-machine-id">hdd configuration / swap / Disk uuid / dbus machine-id</h3>
<p>Since the virtual machine creation tool won't create a swap partition (which is actually good because it simplifies the setup) but the system could run out of memory, add a swap file. The is optional depending on the operating system and available RAM. Configure swap to be used as little as possible to improve speed.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>Swap file creation. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_create-swap-file" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_create-swap-file</a></li>
<li>Activating swap in fstab. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/fstab" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/fstab</a></li>
<li>Only swap to disk if really necessary. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_gateway/etc/sysctl.d/whonix.conf" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_gateway/etc/sysctl.d/whonix.conf</a></li>
<li>Less Important Identifies (Defined as per <a class="alink" href="/p/whonix/wiki/Whonix%27s%20Protocol-Leak-Protection%20and%20Fingerprinting-Protection/">[Whonix's Protocol-Leak-Protection and Fingerprinting-Protection]</a>.)<ul>
<li>Share Disk UUIDs.<ul>
<li>In /etc/fstab. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/fstab" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/fstab</a></li>
<li>Also share uuid for swap file. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_create-swap-file" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_create-swap-file</a></li>
</ul>
</li>
<li>Chang partition uuid. "<em>tune2fs /dev/mapper/loop0p1 -U 26ada0c0-1165-4098-884d-aafd2220c2c6</em>" <a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/35_run-chroot-scripts-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/35_run-chroot-scripts-img</a></li>
<li>Change disk uuid: <a href="https://github.com/adrelanos/Whonix/blob/development/build-steps/45_create-vbox-vm" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/build-steps/45_create-vbox-vm</a></li>
<li>Share dbus machine-id: <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/var/lib/dbus/machine-id" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/var/lib/dbus/machine-id</a></li>
</ul>
</li>
</ul>
<h3 id="base-files">Base Files</h3>
<p>Perhaps only required for Debian and derivatives. Whonix was asked to replace the default dpkg origin symlink.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/dpkg/origins/whonix" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/dpkg/origins/whonix</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_symlinks" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_symlinks</a></li>
</ul>
<h2 id="usability">Usability</h2>
<h3 id="check-mechanism">check mechanism</h3>
<p>Recommend, not strictly required. </p>
<p>Whonix-Example-Implementation:</p>
<p>General Information</p>
<ul>
<li><a class="alink" href="/p/whonix/wiki/whonixcheck/">[whonixcheck]</a></li>
<li>Whonixcheck essentially runs whonixcheck at least once very day.</li>
<li>Whonixcheck, although run on each boot and every hour by cron, itself is rate limited and stops running checks, if it was run less than one day ago. The user can always manually perform all whonixcheck checks.</li>
</ul>
<p>Start Hooks</p>
<ul>
<li>The file <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/whonixcheck_hourly" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/whonixcheck_hourly</a> gets run by cron.hourly <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/cron.hourly/whonixcheck." rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/cron.hourly/whonixcheck.</a></li>
<li>Whonix-Gateway specific<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/profile.d/20_whonixcheck.sh" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/profile.d/20_whonixcheck.sh</a> gets run on every (automatic) login.</li>
</ul>
</li>
<li>Whonix-Workstation specific<ul>
<li>Since Whonix-Workstation is graphical, it's better to use the event by the desktop environment than using profile.d for autostart. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_workstation/home/user/.config/autostart/whonixcheck.desktop" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_workstation/home/user/.config/autostart/whonixcheck.desktop</a></li>
</ul>
</li>
</ul>
<p>Supporting Files</p>
<ul>
<li>Allows running apt-get update as user (non-root). <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/sudoers.d/whonix" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/sudoers.d/whonix</a></li>
<li>Allow wall (with -nobanner option) without password. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/sudoers.d/whonix" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/sudoers.d/whonix</a></li>
<li>Version file to let the whonixcheck find out which version of Whonix is locally installed. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/version" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/version</a></li>
<li>apt-get-update (which has an sudoers exception) runs apt-get update. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/apt-get-update" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/apt-get-update</a></li>
<li>When automatically run by autostart or cron, whonixcheck adds a random delay (to prevent having a predictable network (not web) fingerprint.</li>
<li>gpg key of Whonix maintainer adrelanos to verify Whonix News. <a href="https://github.com/adrelanos/Whonix/tree/development/whonix_shared/usr/local/share/whonix/gpg-pubkeys" rel="nofollow">https://github.com/adrelanos/Whonix/tree/development/whonix_shared/usr/local/share/whonix/gpg-pubkeys</a></li>
<li>Icon. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/icons/whonix.ico" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/icons/whonix.ico</a></li>
<li>xhost exception. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/X0.hosts" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/X0.hosts</a></li>
</ul>
<p>Script</p>
<ul>
<li>The whonixcheck main script. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/whonixcheck" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/whonixcheck</a></li>
<li>The folder with the various checks. <a href="https://github.com/adrelanos/Whonix/tree/development/whonix_shared/usr/local/bin/whonixcheck-scripts" rel="nofollow">https://github.com/adrelanos/Whonix/tree/development/whonix_shared/usr/local/bin/whonixcheck-scripts</a></li>
</ul>
<h3 id="sudoers">sudoers</h3>
<p>Optional. For convenience. Only recommend for Virtual Machines.</p>
<p>Allow shutdown, reboot and poweroff without a password.<br />
Allow starting Tor Controller arm without password. (No effect on Workstation, since arm is only Gateway.)<br />
Allow mixmaster-update without password. (No effect on Gateway, since mixmaster is only installed on Gateway.)</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/sudoers.d/whonix" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/sudoers.d/whonix</a></li>
</ul>
<h3 id="console-autologin">Console Autologin</h3>
<p>Optional. Only recommend for virtual machines.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/inittab" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/inittab</a></li>
</ul>
<h3 id="console-default-password-hint">Console Default Password Hint</h3>
<p>Optional.</p>
<p>The system will be shipped with a default password (which users are suggested to change in documentation). To prevent user frustration when not knowing the password it greatly reduced (from Whonix experience) support requests if the default password is displayed right above the password prompt.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/issue" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/issue</a></li>
</ul>
<h3 id="console-welcome-message">Console Welcome Message</h3>
<p>Optional.</p>
<p>Contains general information about derivative, licensing, default passwords, how to open the help file.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/motd" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/motd</a></li>
</ul>
<h3 id="deactivate-display-power-saving-in-virtual-machines">Deactivate display power saving in Virtual Machines</h3>
<p>Since it's confusing and not useful and not saving any energy. It's not saving energy either. (Needs to be applied on host.)</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/rc.local" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/rc.local</a></li>
</ul>
<h3 id="boot-manager-configuration">boot manager configuration</h3>
<p>Optional. For higher boot resolution, it's required to run update-grub after changing grub configuration files.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>Not yet functional.</li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/grub.d/50_whonix" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/etc/grub.d/50_whonix</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_grub" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_grub</a></li>
</ul>
<h3 id="update-command-not-found">update command not found</h3>
<p>Optional.</p>
<p>Initially update the command not found database, to prevent showing "please run update-command-not-found" in case a non-existent command gets entered in console.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_update-command-not-found" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_update-command-not-found</a></li>
</ul>
<h3 id="securessl-command-line-downloader">Secure/SSL Command Line Downloader</h3>
<p>Add a command line downloader, which enforces using https (SSL).</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>A simple curl wrapper. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/scurl" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/scurl</a></li>
<li>Documented under <a class="" href="https://sourceforge.net/p/whonix/wiki/Software/#scurl-ssl-command-line-downloader">scurl - SSL command line downloader</a></li>
<li>The user starts scurl, the wrapper will run the curl uwt wrapper (/usr/local/bin/curl), which stream isolates and finally calls curl.</li>
</ul>
<h3 id="slim-down">Slim Down</h3>
<p>Optional. To safe space and to prevent (some) development related leaks, remove cache, temporary files, dhcp leases, package manager cache, logs, history.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/80_slimdown" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/80_slimdown</a></li>
</ul>
<h3 id="icons">Icons</h3>
<p>Optional.</p>
<p>Some pretty icons for the start menu and the desktop for custom applications, which are only useful in a Gateway/Workstation design.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/tree/development/whonix_shared/usr/local/share/whonix/icons" rel="nofollow">https://github.com/adrelanos/Whonix/tree/development/whonix_shared/usr/local/share/whonix/icons</a></li>
</ul>
<h2 id="debugging">Debugging</h2>
<h3 id="sanity-checks">Sanity Checks</h3>
<p>Recommend, not strictly required.</p>
<p>Some simple tests to check for example, if the package manager is fully functional, because some virtual machine creation tools build broken images.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/20_root-check" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/20_root-check</a></li>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/30_internal-checks" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/30_internal-checks</a></li>
</ul>
<h3 id="variables">Variables</h3>
<p>Recommend, not strictly required.</p>
<p>It's useful to configure the system, not to ask any questions which require user interaction such as when you plan to run the package manager from within chroot. This is because interaction isn't useful when automating things.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/40_variables" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/40_variables</a></li>
</ul>
<h3 id="package-cache">Package Cache</h3>
<p>Optional.</p>
<p>If the package manager is used inside chroot, it makes sense to run it though a cache, so debugging steps can be done faster.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>apt.conf which can be used in case apt-get gets used inside chroot. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/apt.conf" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/apt.conf</a></li>
</ul>
<p>What is <em>/usr/local/share/whonix/apt.conf</em> good for?</p>
<p>This apt.conf is only used inside chroot and currently only in effect for "<em>./debug-steps/download-source -tg</em>" and "<em>./debug-steps/download-source -tw</em>".</p>
<p>It points to <em>http://192.168.0.11:3142</em>, which is expected to be a Whonix-Workstation with apt-cacher-ng running. It's useful for running "<em>apt-get install</em>" and "<em>apt-get source</em>" inside chroot, because downloads are cached, which speeds up the build process when building several times in a row. (Debugging with only minor changes.)</p>
<p>In case you don't want to use it or to use another proxy, edit <em>/home/user/Whonix/whonix_shared/usr/local/share/whonix/apt.conf</em> (comment out with a # or change proxy settings). Don't forget "<em>sudo ./build-steps/30_copy-into-img -tX</em>" after modifying the file.</p>
<ul>
<li>Script to run apt-cacher-ng through uwt for Stream Isolation. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/apt-cacher-ng_uwt" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/bin/apt-cacher-ng_uwt</a></li>
</ul>
<h3 id="prevent-daemons-from-starting-inside-chroot">Prevent daemons from starting inside chroot</h3>
<p>Optional.</p>
<p>Only in case you want to install something inside chroot for debugging purposes. Otherwise they can lock the chroot folder and you won't be able to unchroot.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>policy-rc.d blocks daemons from starting. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/policy-rc.d" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/policy-rc.d</a></li>
<li>policy-rc.d gets copied into chroot when chrooting. <a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/chroot-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/chroot-img</a></li>
<li>policy-rc.d gets deleted inside chroot when leaving chroot. <a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/unchroot-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/unchroot-img</a></li>
</ul>
<h3 id="indicate-last-chroot-script">Indicate last chroot script</h3>
<p>Not strictly required. A chroot script, which indicates that all went well.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/90_end" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/90_end</a></li>
</ul>
<h3 id="lower-priority-while-building">Lower priority while building</h3>
<p>Optional. Not strictly required.</p>
<p>Using ionice and renice.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/pre" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/pre</a></li>
</ul>
<h3 id="enable-debugging">Enable debugging</h3>
<p>Optional. Not strictly required.</p>
<p>When using bash, set -x to show each any any command that gets executed.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/pre" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/pre</a></li>
</ul>
<h3 id="error-handling">Error handling</h3>
<p>Optional. Not strictly required.</p>
<p>It's important to ensure that there are no error while copying files into the images or while running the chroot scripts because many steps are essential. Stop and loudly complain if any unexpected error occurs.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>general trap: <a href="https://github.com/adrelanos/Whonix/blob/development/help-steps/pre" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/help-steps/pre</a></li>
<li>using traps and exit 1 everywhere</li>
</ul>
<h3 id="delete-virtual-machine-files">Delete Virtual Machine files</h3>
<p>Optional. Not strictly required.</p>
<p>So they can be re-created for debugging purposes.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/debug-steps/delete-vbox-vm" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/debug-steps/delete-vbox-vm</a></li>
</ul>
<h3 id="interactive-chroot">Interactive Chroot</h3>
<p>Optional. Not strictly required.</p>
<p>After creating the base operating system image, after copying files into it or after applying the chroot scripts, it's useful to have a command, which allows to look around inside the image without having to boot the image. Adrelanos calls this Interactive Chroot.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/debug-steps/interactive-chroot-img" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/debug-steps/interactive-chroot-img</a></li>
</ul>
<h2 id="licensing">Licensing</h2>
<p>Only required for builds, which will be redistributed in public.</p>
<p>Make a list of GPLed software.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>Added <a class="" href="http://dberkholz.com/2004/02/" rel="nofollow">damngpl</a>. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/damngpl" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/damngpl</a></li>
<li>Creating a list of GPLed software. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_sources" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/chroot-scripts/70_sources</a></li>
<li>A script to download all GPLed software, which can be run inside the virtual machine or inside chroot. <a href="https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/whonix_download_sources" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_shared/usr/local/share/whonix/whonix_download_sources</a></li>
<li>The source code needs a License file. <a href="https://github.com/adrelanos/Whonix/blob/development/LICENSE" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/LICENSE</a></li>
</ul>
<h1 id="build-automation">Build Automation</h1>
<p>Optional. Not strictly required.</p>
<p>Since many steps are required to build a Gateway or Workstation, it's useful to automate build creation.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://github.com/adrelanos/Whonix/blob/development/whonix_build" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/whonix_build</a></li>
<li><a class="alink" href="/p/whonix/wiki/BuildDocumentation/">[BuildDocumentation]</a></li>
</ul>
<h1 id="release-automation">Release Automation</h1>
<p>Optional. Not strictly required.</p>
<p>Since many steps are required to redistribute a Gateway or Workstation, it's useful to automate releases.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li>Release maintenance folder: <a href="https://github.com/adrelanos/Whonix/blob/development/release/README" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/release/README</a></li>
<li>sourceforge.net Download Readme: <a href="https://github.com/adrelanos/Whonix/blob/development/release/README" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/release/README</a></li>
<li>Whonix News File: <a href="https://github.com/adrelanos/Whonix/blob/development/release/whonix_news" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/release/whonix_news</a></li>
<li>Script to automate gpg signing, verification (as sanity check) and upload sourceforge.net Download Readme: <a href="https://github.com/adrelanos/Whonix/blob/development/release/upload_download_readme" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/release/upload_download_readme</a></li>
<li>Script to automate gpg signing, verification (as sanity check) and upload Whonix News File: <a href="https://github.com/adrelanos/Whonix/blob/development/release/upload_whonix_news" rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/release/upload_whonix_news</a></li>
<li>Building and uploading of Virtual Machine Images. Fully documented on <a href="https://sourceforge.net/p/whonix/wiki/Dev_Redistribution/">https://sourceforge.net/p/whonix/wiki/Dev_Redistribution/</a> and <a href="https://github.com/adrelanos/Whonix/blob/development/release/whonix_release." rel="nofollow">https://github.com/adrelanos/Whonix/blob/development/release/whonix_release.</a></li>
</ul>
<h1 id="other-important-things">Other important things</h1>
<p>The things on this (Design-Shared) page are supposed to be added to the Gateway and the Workstation.</p>
<p>To build a Gateway, also things from the <a class="alink" href="/p/whonix/wiki/Design-Gateway/">[Design-Gateway]</a> page have to be added.</p>
<p>To build a Workstation, also things from the <a class="alink" href="/p/whonix/wiki/Design-Workstation/">[Design-Workstation]</a> page have to be added.</p>
<p>Justify other design decisions, what the project doesn't and what it doesn't do.<br />
Have loads of documentation. Have a source code hacking guide and source code introduction.</p>
<p>Whonix-Example-Implementation:</p>
<ul>
<li><a href="https://sourceforge.net/p/whonix/wiki/Design-Gateway">https://sourceforge.net/p/whonix/wiki/Design-Gateway</a></li>
<li><a href="https://sourceforge.net/p/whonix/wiki/Design-Workstation">https://sourceforge.net/p/whonix/wiki/Design-Workstation</a></li>
<li><a href="https://sourceforge.net/p/whonix/wiki/Design/">https://sourceforge.net/p/whonix/wiki/Design/</a></li>
<li><a href="https://sourceforge.net/p/whonix/wiki/Documentation/">https://sourceforge.net/p/whonix/wiki/Documentation/</a></li>
<li><a href="https://sourceforge.net/p/whonix/wiki/Dev_SourceCode/">https://sourceforge.net/p/whonix/wiki/Dev_SourceCode/</a></li>
<li><a href="https://sourceforge.net/p/whonix/wiki/Dev_SourceCodeIntro/">https://sourceforge.net/p/whonix/wiki/Dev_SourceCodeIntro/</a></li>
</ul>
<h1 id="footer">Footer</h1>
<div>
<div class="markdown_content"><p>This is a wiki. Want to improve this page? Contact us!</p>
<p><font size="-3">Unless otherwise noted above, content of this particular page is copyrighted by <a class="" href="mailto:adrelanos%20at%20riseup%20dot%20net">adrelanos</a> and licensed under the same Free (as in speech) license as Whonix itself.</font></p></div>
</div>
</div>

  <div id="create_wiki_page_holder" title="Create New Page" style="display:none">
    <form>
        <label class="grid-2">Name</label>
        <div class="grid-7"><input type="text" name="name"/></div>
    </form>
  </div>

          </div>
			
          
  <hr class="grid-19" style="margin-top: 1em; margin-bottom: 2em; clear:both;">
  
  
    <h4>Related</h4>
    <p>
    
      <a href="/p/whonix/wiki/Design-Gateway/">Wiki: Design-Gateway</a><br>
    
      <a href="/p/whonix/wiki/Design-Workstation/">Wiki: Design-Workstation</a><br>
    
      <a href="/p/whonix/wiki/BuildDocumentation/">Wiki: BuildDocumentation</a><br>
    
      <a href="/p/whonix/wiki/whonixcheck/">Wiki: whonixcheck</a><br>
    
      <a href="/p/whonix/wiki/Whonix%27s%20Protocol-Leak-Protection%20and%20Fingerprinting-Protection/">Wiki: Whonix&#39;s Protocol-Leak-Protection and Fingerprinting-Protection</a><br>
    
      <a href="/p/whonix/wiki/Stream%20Isolation/">Wiki: Stream Isolation</a><br>
    
      <a href="/p/whonix/wiki/TimeSync/">Wiki: TimeSync</a><br>
    
      <a href="/p/whonix/wiki/PhysicalIsolation/">Wiki: PhysicalIsolation</a><br>
    
      <a href="/p/whonix/wiki/OperatingSystem/">Wiki: OperatingSystem</a><br>
    
      <a href="/p/whonix/wiki/Design/">Wiki: Design</a><br>
    
      <a href="/p/whonix/wiki/Dev_SourceCode/">Wiki: Dev_SourceCode</a><br>
    
    </p>
  
  

        </div>
      </div>
    </section>
      
<footer id="site-footer">
    <div class="wrapper">
        <nav>
            <h5>SourceForge</h5>
            <a href="/about">About</a>
            <a href="/blog/category/sitestatus/">Site Status</a>
            <a href="http://twitter.com/sfnet_ops">@sfnet_ops</a>
        </nav>
        <nav>
            <h5>Find and Develop Software</h5>
            <a href="/create/">Create a Project</a>
            <a href="/directory/">Software Directory</a>
            <a href="/top">Top Downloaded Projects</a>
        </nav>
        <nav>
            <h5>Community</h5>
            <a href="/blog/">Blog</a>
            <a href="http://twitter.com/sourceforge">@sourceforge</a>
            <a href="/jobs?source=footer">Job Board</a>
        </nav>
        <nav>
            <h5>Help</h5>
            <a href="http://p.sf.net/sourceforge/docs">Site Documentation</a>
            <a href="/support">Support Request</a>
            <a href="http://p.sf.net/sourceforge/irc">Real-Time Support</a>
        </nav>
    </div>
</footer>
<footer id="site-copyright-footer">
    <div class="wrapper">
        <div id="copyright">
            Copyright &copy; 2013 SourceForge. All Rights Reserved.<br />
            SourceForge is a <a href="http://www.diceholdingsinc.com/phoenix.zhtml?c=211152&amp;p=irol-landing">Dice Holdings, Inc.</a> company.
        </div>
        <nav>
            <a href="http://slashdotmedia.com/terms-of-use">Terms</a>
            <a href="http://slashdotmedia.com/privacy-statement/">Privacy</a>
            <a href="http://slashdotmedia.com/opt-out-choices">Cookies/Opt Out</a>
            <a href="http://slashdotmedia.com">Advertise</a>
            <a href="http://sourceforge.jp/">SourceForge.JP</a>
        </nav>
    </div>
</footer>
    <div id="messages">
        
    </div>
    
      <!-- ew:body_js -->

    
      <script type="text/javascript" src="http://a.fsdn.com/allura/nf/1364319766/_ew_/_slim/js?href=allura%2Fjs%2Fjquery-base.js%3Ballura%2Fjs%2Fjquery.notify.js%3Ballura%2Fjs%2Fsylvester.js%3Ballura%2Fjs%2Fpb.transformie.min.js%3Ballura%2Fjs%2Fallura-base.js%3Bjs%2Fjquery.lightbox_me.js%3Bjs%2Fjquery.autosize-min.js%3Bjs%2Fjquery.textarea.js%3Bjs%2Fsf_markitup.js%3Bjs%2Fjquery.tagsinput.js"></script>
    
      
<!-- /ew:body_js -->

    
    
      <!-- ew:body_js_tail -->

    
      <script type="text/javascript">$(function () {
            var $lightbox = $('#lightbox_create_wiki_page');
            var $trigger = $('#sidebar a.add_wiki_page');
            $trigger.bind('click', function(e) {
                $lightbox.lightbox_me();
                return false;
            });
            $($lightbox).delegate('.close', 'click', function(e) {
                $lightbox.trigger('close');
                return false;
            });
        });
$(function () {
            $('#lightbox_create_wiki_page form').submit(function(){
                location.href = $('#sidebar a.add_wiki_page').attr('href') +
                    encodeURIComponent($('input[name=name]', $(this)).val().replace('/', '-')) + '/edit';
                return false;
            });
        });
$(function () {
            $('textarea.auto_resize').focus(function(){$(this).autosize();});
        });
$(document).ready(function () {
            $("a.attachment_form_add_button").click(function(evt){
                $(this).hide();
                $(".attachment_form_fields", this.parentNode).show();
                evt.preventDefault();
            });
            $("a.cancel_edit_post").click(function(evt){
                $("textarea", this.parentNode).val($("input.original_value", this.parentNode).val());
                $(".attachment_form_fields input", this.parentNode).val('');
                evt.preventDefault();
            });
         });

        (function () {
            $('div.discussion-post').each(function () {
                var post = this;
                $('.submit', post).button();
                $('.flag_post', post).click(function (ele) {
                    this.parentNode.submit();
                    return false;
                });
                $('.moderate_post', post).click(function(e){
                    e.preventDefault();
                    var mod = $(this).text();
                    var id_post = $(post).attr('id');
                    $.ajax({
                        type: 'POST',
                        url: this.parentNode.action,
                        data: jQuery(this.parentNode).serialize(),
                        success: function() {
                            if (mod == 'Delete'){
                                $(post).remove();
                            }
                            else if (mod == 'Approve'){
                                $('a.reply_post, a.shortlink, form.moderate_spam, form.moderate_approve', post).toggle();
                                $('div.moderate', post).removeClass('moderate');
                            }
                            else if (mod == 'Spam'){
                                $(post).remove();
                            }
                        }
                    });
                });

                if($('a.edit_post', post)){
                    $('a.edit_post', post).click(function (ele) {
                        $('.display_post', post).hide();
                        $('.edit_post_form', post).show();
                        $('.edit_post_form textarea', post).focus();
                        return false;
                    });
                    $("a.cancel_edit_post", post).click(function(evt){
                        $('.display_post', post).show();
                        $('.edit_post_form', post).hide();
                    });
                }
                if($('.reply_post', post)){
                    $('.reply_post', post).click(function (ele) {
                        $('.reply_post_form', post).show();
                        $('.reply_post_form textarea', post).focus();
                        return false;
                    });
                    $('.reply_post', post).button();
                }
                if($('.add_attachment', post)){
                    $('.add_attachment', post).click(function (ele) {
                        $('.add_attachment_form', post).show();
                        return false;
                    });
                }
                if($('.promote_to_thread', post)){
                    $('.promote_to_thread', post).click(function (ele) {
                        $('.promote_to_thread_form', post).show();
                        return false;
                    });
                }
                if($('.shortlink', post)){
                    var popup = $('.shortlink_popup', post);
                    $('.shortlink', post).click(function(evt){
                        evt.preventDefault();
                        popup.lightbox_me({
                            onLoad: function() {
                                $('input', popup).select();
                            }
                        });
                    });
                    $('.close', popup).bind('click', function() {
                        popup.hide();
                    });
                }
            });
        }());
        
$(function () {
            $('select.results_per_page').change(function () {
                this.form.submit();});});
$(function () {
          $('input.label_edit').tagsInput({
              'height':'100%',
              'width':'100%'
          });
        });

        $(document).ready(function () {
            var thread_tag = $('a.thread_tag');
            var thread_spam = $('a.sidebar_thread_spam');
            var tag_thread_holder = $('#tag_thread_holder');
            var allow_moderate = $('#allow_moderate');
            var mod_thread_link = $('#mod_thread_link');
            var mod_thread_form = $('#mod_thread_form');
            if (mod_thread_link.length) {
                if (mod_thread_form.length) {
                    mod_thread_link.click(function (e) {
                        mod_thread_form.show();
                        return false;
                    });
                }
            }
            if (thread_tag.length) {
                if (tag_thread_holder.length) {
                    var submit_button = $('input[type="submit"]', tag_thread_holder);
                    var cancel_button = $('<a href="#" class="btn link">Cancel</a>').click(function(evt){
                        evt.preventDefault();
                        tag_thread_holder.hide();
                        thread_tag.removeClass('active');
                    });
                    submit_button.after(cancel_button);
                    thread_tag.click(function (e) {
                        tag_thread_holder.show();
                        thread_tag.addClass('active');
                        // focus the submit to scroll to the form, then focus the subject for them to start typing
                        submit_button.focus();
                        $('input[type="text"]', tag_thread_holder).focus();
                        return false;
                    });
                }
            }
            if (thread_spam.length) {
                if (allow_moderate.length) {
                    var cval = $.cookie('_session_id');
                    thread_spam[0].style.display='block';
                }
            }
        });
        </script>
    
      
<!-- /ew:body_js_tail -->

    
    
  <div id="lightbox_create_wiki_page" class="modal" style="display:none">
  <b data-icon="D" class="ico ico-close close"></b>
  
    <h1>Add a Wiki Page</h1>
    <form class="grid-10">
        <label class="grid-2">Name</label>
        <div class="grid-7"><input type="text" name="name"></div>
        <label class="grid-2">&nbsp;</label>
        <div class="grid-7"><input type="submit" value="Create page"></div>
    </form>
  
</div>
<script type="text/javascript">
  /*<![CDATA[*/
  $('.post-link')
    .click(function(evt) {
        var cval = $.cookie('_session_id');
        evt.preventDefault();
        $.post(this.href, {_session_id:cval}, function(val)
            { window.location = val.location; },
            'json');
      });
  /*]]>*/
</script>
  

    
      
    
    
   
    
  </body>
</html>