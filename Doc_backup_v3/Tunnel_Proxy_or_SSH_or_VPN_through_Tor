<!DOCTYPE html>
<!-- Server: sfn-web-5 -->


  










<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]>--> <html lang="en" class="no-js"> <!--<![endif]-->
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type"/>
    <title>Whonix / Documentation / Tunnel_Proxy_or_SSH_or_VPN_through_Tor</title>
    

<script src="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/js/sftheme/modernizr.custom.90514.js"></script>

<script src="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/js/sftheme/jquery-1.8.0.min.js"></script>

<script src="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/js/sftheme/header.js"></script>
<!--[if lt IE 7 ]>
  <script src="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/js/sftheme/dd_belatedpng.js"></script>
  <script> DD_belatedPNG.fix('img, .png_bg'); //fix any <img> or .png_bg background-images </script>
<![endif]-->
<link href='//fonts.googleapis.com/css?family=Ubuntu:regular' rel='stylesheet' type='text/css'>
<style type="text/css">
    @font-face {
        font-family: "Pictos";
        src: url('http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/fonts/sftheme/pictos-web.eot');
        src: local("â˜º"), url('http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/fonts/sftheme/pictos-web.woff') format('woff'), url('http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/fonts/sftheme/pictos-web.ttf') format('truetype'), url('http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/fonts/sftheme/pictos-web.svg') format('svg');
    }
</style>
    <script type="text/javascript">
            /*jslint onevar: false, nomen: false, evil: true, css: true, plusplus: false, white: false, forin: true, on: true, immed: false */
            /*global confirm, alert, unescape, window, jQuery, $, net, COMSCORE */
    </script>
    
      <!-- ew:head_css -->

    
      <link rel="stylesheet"
                type="text/css"
                href="http://a.fsdn.com/allura/nf/1364319766/_ew_/allura/css/forge/hilite.css"
                >
    
      <link rel="stylesheet"
                type="text/css"
                href="http://a.fsdn.com/allura/nf/1364319766/_ew_/tool/wiki/css/wiki.css"
                >
    
      <link rel="stylesheet"
                type="text/css"
                href="http://a.fsdn.com/allura/nf/1364319766/_ew_/theme/sftheme/css/forge.css"
                >
    
      <link rel="stylesheet"
                type="text/css"
                href="http://a.fsdn.com/allura/nf/1364319766/_ew_/_slim/css?href=css%2Fmarkitup_sf.css%3Bcss%2Fpage_list.css%3Bcss%2Fjquery.tagsinput.css"
                >
    
      
<!-- /ew:head_css -->

    
    
    
      <!-- ew:head_js -->

    
      
<!-- /ew:head_js -->

    
    

    
      <style type="text/css">
        #page-body.project---init-- #top_nav { display: none; }
#page-body.project---init-- #nav_menu_holder { display: none; margin-bottom: 0; }
#page-body.project---init-- #content_base {margin-top: 0; }
      </style>
    
    
<style>
  .hidden { display: none }
  a.notfound { color: #f00; }
</style>

      <style>.XPwpCBsGDeGTApgvtkkFWdf { display:none }</style>

    
<link rel="alternate" type="application/rss+xml" title="Page RSS" href="feed.rss"/>
<link rel="alternate" type="application/atom+xml" title="Page Atom" href="feed.atom"/>
<link rel="alternate" type="application/rss+xml" title="Wiki RSS" href="../feed.rss"/>
<link rel="alternate" type="application/atom+xml" title="Wiki Atom" href="../feed.atom"/>

    
    


<script type="text/javascript">
    var _gaq = _gaq || [];

    function _add_tracking(prefix, tracking_id, send_user) {
        _gaq.push([prefix+'._setAccount', tracking_id]);
        _gaq.push([prefix+'._setCustomVar', 1, 'Page Type', 'wiki', 3]);_gaq.push([prefix+'._trackPageview']);
    }
      _add_tracking('sfnt1', 'UA-32013-6', true);
      _add_tracking('sfnt2', 'UA-36130941-1', true);
    

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' === document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </head>

  <body class="wiki-Tunnel_Proxy_or_SSH_or_VPN_through_Tor" id="forge">
    
      <!-- ew:body_top_js -->

    
      
<!-- /ew:body_top_js -->

    
    
<header id="site-header">
    <div class="wrapper">
        <a href="/" class="logo">
            <span>SourceForge</span>
        </a>
        
        <form method="get" action="/directory/">
            <input type="text" id="words" name="q" placeholder="Search">
        </form>
        
        <!--Switch to {language}-->
        <nav id="nav-site">
            <a href="/directory/" title="Browse our software.">Browse</a>
            <a href="/directory/enterprise" title="Browse our Enterprise software.">Enterprise</a>
            <a href="/blog/" title="Read the latest news from the SF HQ.">Blog</a>
            <a href="/support" title="Contact us for help and feedback.">Help</a>
            <a href="/jobs?source=header" title="Search 80k+ tech jobs." class="featured-link">Jobs</a>
        </nav>
        <nav id="nav-account">
            
              <div class="logged_out">
                <a href="/account/login.php">Log In</a>
                <span>or</span>
                <a href="https://sourceforge.net/user/registration/">Join</a>
              </div>
            
        </nav>
        
    </div>
</header>
<header id="site-sec-header">
    <div class="wrapper">
        <nav id="nav-hubs">
            <h4>Solution Centers</h4>
            <a href="http://ibmsmartercommerce.sourceforge.net/">Smarter Commerce</a>
            <a href="http://goparallel.sourceforge.net/">Go Parallel</a>
            <a href="http://html5center.sourceforge.net/">HTML5</a>
            <a href="http://ibmsmarteritservices.sourceforge.net/">Smarter IT</a>
        </nav>
        <nav id="nav-collateral">
            <a href="http://library.geeknetmedia.com">Resources</a>
            
            <a href="">Newsletters</a>
            
        </nav>
    </div>
</header>
    
    <section id="page-body" class=" neighborhood-Projects project-whonix mountpoint-wiki">
	  <div class="grid-24" id="nav_menu_holder">
            
            


  
  <a href="/p/whonix/">
    
      <img src="/p/whonix//icon?2012-10-18 23:06:52+00:00" class="project_icon" alt="Project Logo">
    
	<h1 class="project_title">
      
        Whonix
      
	</h1>
	</a>

            
      </div>
      <div id="top_nav" class="">
        
        
  
    <a href="/p/whonix/homelink/" class="ui-icon-tool-link">
      Homepage
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/wiki/" class="ui-icon-tool-wiki">
      Documentation
      
        
          <span class="diamond"></span>
        
      
      
      
    </a>
	
    <a href="/p/whonix/blog/" class="ui-icon-tool-blog">
      Important Blog
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/featureblog/" class="ui-icon-tool-blog">
      Feature Blog
      
        
      
      
      
    </a>
	
    <a href="/projects/whonix/files/" class="ui-icon-tool-files">
      _
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/discussion/" class="ui-icon-tool-discussion">
      User Help Forum
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/mailman/" class="ui-icon-tool-mailman">
      Developer Mailing List
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/code/" class="ui-icon-tool-git">
      Source Code
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/donate/" class="ui-icon-tool-link">
      Donate
      
        
      
      
      
    </a>
	
    <a href="/p/whonix/awiki/" class="ui-icon-tool-wiki">
      _
      
        
      
      
      
    </a>
	
	<div style="clear:both"></div>

        
      </div>
      <div id="content_base">
			  
          
        
			  
          
        
        <div class="grid-24 pad">
          <h2 class="dark title">Tunnel_Proxy_or_SSH_or_VPN_through_Tor
            <!-- actions -->
            <small>
            
  
    
    <a href="history" title="History"><b data-icon="N" class="ico ico-history" title="History"></b></a>
  
  
	<a href="feed" title="RSS"><b data-icon="f" class="ico ico-feed" title="Feed"></b></a>
  <a href="../search" title="Search"><b data-icon="s" class="ico ico-search" title="Search"></b></a>

            </small>
            <!-- /actions -->
          </h2>
		
  

          <div>
            
            
  
<div class="markdown_content"><div>
<div class="markdown_content"><p><a class="" href="https://sourceforge.net/p/whonix/wiki/Home/#whonix-homepage">Whonix Homepage</a> | <img alt="" src="http://whonix.sourceforge.net/screenshots/BC_Rnd_32px.png" /> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Contribute/#donate">Donate</a></p>
<p><a class="" href="https://sourceforge.net/p/whonix/wiki/Download/#stay-tuned">News</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Screenshots/">Screenshots</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Videos/">Videos</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Download/">Download</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Documentation/">Documentation</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/About/">About</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Features/">Features</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Security%20Guide/">Security Guide</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/FAQ/">FAQ</a> | <a class="" href="https://sourceforge.net/p/whonix/discussion/">Forum</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Contact/">Contact</a></p>
<p><a class="" href="https://sourceforge.net/p/whonix/wiki/Bridges/">Bridges Support</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Features/#vpn-tunnel-support">VPN/Tunnel Support</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/HostingLocationHiddenServers/">Location/IP Hidden Servers</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/OtherOperatingSystems/">Windows Support</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/BrowserPlugins/">Flash Support</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Contribute/">You Can Help</a></p>
<p><a class="" href="https://sourceforge.net/p/whonix/wiki/Contribute/">Contribiute</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Design/">Tech. Design</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Dev_SourceCode/">Source Code / Hacking / Development Tickets</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Changelog/">Changelog</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Authorship/">Authorship</a> | <a class="" href="https://sourceforge.net/p/whonix/wiki/Authorship/#disclaimer">Disclaimer</a></p>
<p><font size="-3">This is a wiki. Want to improve this page? Contact us!</font></p></div>
</div>
<div class="toc">
<ul>
<li><a href="#tunnel-proxysshvpn-through-tor">Tunnel Proxy/SSH/VPN through Tor</a><ul>
<li><a href="#required-knowledge">Required Knowledge</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#uwt-and-tor-browser">uwt and Tor Browser</a></li>
<li><a href="#malware">Malware</a></li>
<li><a href="#leaks">Leaks</a></li>
<li><a href="#web-browser">Web Browser</a></li>
</ul>
</li>
<li><a href="#tunnel-proxy-through-tor">Tunnel proxy through Tor</a><ul>
<li><a href="#proxy-settings-method">Proxy Settings Method</a></li>
<li><a href="#proxyfier-method">Proxyfier Method</a><ul>
<li><a href="#general">General</a></li>
<li><a href="#uwt">uwt</a></li>
<li><a href="#proxychains">proxychains</a></li>
</ul>
</li>
<li><a href="#transparent-proxying">Transparent Proxying</a><ul>
<li><a href="#introduction_1">Introduction</a><ul>
<li><a href="#tools">Tools</a></li>
<li><a href="#dns-resolution">DNS resolution</a></li>
</ul>
</li>
<li><a href="#howto">HowTo</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#tunnel-ssh-through-tor">Tunnel SSH through Tor</a></li>
<li><a href="#tunnel-vpn-through-tor">Tunnel VPN through Tor</a><ul>
<li><a href="#notes">Notes</a><ul>
<li><a href="#udp">UDP</a></li>
<li><a href="#using-transport-instead-of-socksport-is-required-for-tor-vpn">Using TransPort instead of SocksPort is required for Tor -&gt; VPN</a></li>
<li><a href="#vpn-breakdown">VPN breakdown</a></li>
<li><a href="#vpn-and-stream-isolation">VPN and stream isolation</a></li>
<li><a href="#identity-correlation">Identity correlation</a></li>
</ul>
</li>
<li><a href="#how">How</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#footer">Footer</a></li>
</ul>
</div>
<h1 id="tunnel-proxysshvpn-through-tor">Tunnel Proxy/SSH/VPN through Tor</h1>
<h2 id="required-knowledge">Required Knowledge</h2>
<h3 id="introduction">Introduction</h3>
<p><strong>user -&gt; Tor -&gt; Proxy/SSH/VPN</strong></p>
<p>Read first: <a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorPlusVPN" rel="nofollow">Tor Plus VPN or proxy</a> and <a class="" href="https://sourceforge.net/p/whonix/wiki/Authorship/#whonix-vpn-disclaimer">Whonix VPN disclaimer</a>.</p>
<p>You can tunnel through Tor first and add an additional proxy, SSH or VPN hop at the very end of that chain as your "exit node". The services you connect to, will not know, that you are using Tor ^1^. This can be useful to <strong>evade Tor bans</strong>, for example, to visit websites or IRC networks who blacklisted Tor. Beware of the risks, this adds a "permanent exit node", read <a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorPlusVPN" rel="nofollow">Tor Plus VPN or proxy</a>.</p>
<p>To do that, go to your Whonix-Workstation and add the proxy, SSH or VPN normally, just like you would do, if you wouldn't use the Whonix-Gateway. Adding your proxy, SSH or VPN inside Whonix-Workstation will, thanks to Whonix-Gateway, result in them getting tunneled over Tor.</p>
<p><a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO" rel="nofollow">Protocol leaks</a> still apply, thought to a lesser extend. Leaks would <em>only</em> leak through Tor and you have best possible <a class="" href="https://sourceforge.net/p/whonix/wiki/Whonix%27s%20Protocol-Leak-Protection%20and%20Fingerprinting-Protection/">Protocol-Leak-Protection and Fingerprinting-Protection</a>.</p>
<p><font size="-3"><br />
,,<br />
^1^ Unless it's a "transparent proxy" in sense of sending http forwarded for, covered in the <a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorPlusVPN" rel="nofollow">Tor Plus VPN or proxy</a> article.<br />
</font></p>
<h3 id="uwt-and-tor-browser">uwt and Tor Browser</h3>
<p>There are two special cases in Whonix. Applications using uwt and Tor Browser. These are pre-configured to use Socks Proxy settings. (<font size="-3">(...and not just TransPort, which is a security feature: Stream Isolation.)</font></p>
<p>You may have to disable the affected uwt wrapper, in case there is one, for the application you want to tunnel. See <a class="" href="https://sourceforge.net/p/whonix/wiki/Stream%20Isolation/">Stream Isolation</a> to learn what uwt and uwt wrappers are. For example to deactivate the uwt wrapper for wget, you could use.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">chmod</span> <span class="o">-</span><span class="n">x</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span>
</pre></div>
<p>If you want to do it with Tor Browser, you must <a class="" href="https://sourceforge.net/p/whonix/wiki/TorBrowser/#remove-proxy-settings">Remove Proxy Settings</a>.</p>
<h3 id="malware">Malware</h3>
<p>Also note, that once Whonix-Workstation gets rooted by malware, the VPN/SSH/proxy can be easily circumvented by the attacker and you are left to the protections by Whonix and Tor.</p>
<h3 id="leaks">Leaks</h3>
<p>If setting up socksifier, proxy settings, transparent proxy with local redirection, SSH tunnel or a VPN in a leak free manner were easy, this means while ensuring nothing will bypass the VPN, SSH or proxy, there would have been no reason to develop Whonix in the first place.</p>
<p>The methods described on this page are all tested and should all more or less work. Should there be any misconfiguration or leak bug, you are left to the protections by Whonix and Tor. This means, the leak will still go through Whonix-Gateway and therefore Tor. The methods on this page are not as safe as a Whonix-Gateway. There were development discussions and <a class="" href="https://sourceforge.net/p/whonix/wiki/Inspiration/">some progress</a>, about chaining multiple Gateways, VPNBOX, JonDoBOX, i2pBOX, FreenetBOX and ProxyBOX, but nothing was finished to to lack of community interest, support and developers.</p>
<h3 id="web-browser">Web Browser</h3>
<p>I don't know how anonymous it is to use (VPN -&gt;) Tor -&gt; VPN -&gt; Tor Browser -&gt; website. How many people show up with a VPN IP using Tor Browser? This setup is so special that I believe only very few people are doing it. For this reason, I recommend against.</p>
<p>On the other hand, due to browser fingerprinting, I can't really recommend to use another browser than Tor Browser either.</p>
<h2 id="tunnel-proxy-through-tor">Tunnel proxy through Tor</h2>
<p><strong>user -&gt; Tor -&gt; proxy</strong></p>
<p>Note, that the connection, between the Tor exit node and the proxy, is in most cases, not encrypted.</p>
<h3 id="proxy-settings-method">Proxy Settings Method</h3>
<p>After understanding the <em>Required Knowledge</em> chapter above, using proxy settings in Whonix there is no difference from using proxy settings in an ordinary why, other than that it's running inside Whonix-Workstation.</p>
<p>If proxy settings are honored by application or in worst case leak through Tor alone (thanks to Whonix), is another question and not in Whonix's power, see <a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO" rel="nofollow">TorifyHOWTO</a>.</p>
<h3 id="proxyfier-method">Proxyfier Method</h3>
<h4 id="general">General</h4>
<p>After understanding the <em>Required Knowledge</em> chapter above, using a Proxyfier in Whonix there is no difference from using a Proxyfier in an ordinary way, other than that it's running inside Whonix-Workstation.</p>
<p>If the Proxifier is leak free or in worst case leaks through Tor alone (thanks to Whonix), is another question and not in Whonix's power, see <a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO" rel="nofollow">TorifyHOWTO</a>.</p>
<h4 id="uwt">uwt</h4>
<p>uwt uses torsocks. While the name implies it's Tor specific, it's not. You can point it to any socks proxy. Examples.</p>
<div class="codehilite"><pre><span class="c">## For Tor stream isolation #1</span>
<span class="n">uwt</span> <span class="o">-</span><span class="n">t</span> 5 <span class="o">-</span><span class="n">i</span> 192<span class="p">.</span>168<span class="p">.</span>0<span class="p">.</span>10 <span class="o">-</span><span class="n">p</span> 9153 <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">wget</span> <span class="o">-</span><span class="n">c</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">check</span><span class="p">.</span><span class="n">torproject</span><span class="p">.</span><span class="n">org</span>

<span class="c">## For Tor stream isolation #2</span>
<span class="n">uwt</span> <span class="o">-</span><span class="n">t</span> 5 <span class="o">-</span><span class="n">i</span> 192<span class="p">.</span>168<span class="p">.</span>0<span class="p">.</span>10 <span class="o">-</span><span class="n">p</span> 9154 <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">wget</span> <span class="o">-</span><span class="n">c</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">check</span><span class="p">.</span><span class="n">torproject</span><span class="p">.</span><span class="n">org</span>

<span class="c">## Proxy</span>
<span class="n">uwt</span> <span class="o">-</span><span class="n">t</span> 5 <span class="o">-</span><span class="n">i</span> <span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span><span class="n">p</span> <span class="n">xxxx</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">wget</span> <span class="o">-</span><span class="n">c</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">check</span><span class="p">.</span><span class="n">torproject</span><span class="p">.</span><span class="n">org</span>
</pre></div>
<p><font size="-3"></font></p>
<p>For testing, if you didn't disable the wget uwt wrapper, the following command will most likely get another IP, because still using Stream Isolation.</p>
<div class="codehilite"><pre><span class="c">## Using Tor's TransPort</span>
<span class="c">## (/usr/local/bin/wget uwt wrapper)</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">check</span><span class="p">.</span><span class="n">torproject</span><span class="p">.</span><span class="n">org</span>
</pre></div>
<h4 id="proxychains">proxychains</h4>
<p><strong>WARNING</strong>:</p>
<ul>
<li>I don't know how well proxychains works. For example <a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/torsocks#WorkaroundforIPv6leakbug" rel="nofollow">torsocks has a IPv6 leak bug</a>. I don't know if proxychains forces everything through the proxies. Whonix only ensures, should their be leaks, they go only through Tor.</li>
<li>There are at least three different versions of proxychains. The old/original/unmaintained version on sourceforge.net and two forks on github. I don't know about that status of any of them and haven't heard of anyone looking if they do really work as expected. The two authors argue with each other and I wasn't motivated to understand the conflict and to determine which version is better. However, any leaks not going through the proxy(chain) will go through Tor.</li>
</ul>
<p>Instructions:</p>
<p>Install proxychains.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">proxychains</span>
</pre></div>
<p>Note the uwt and Tor Browser notice in <em>Required Knowledge</em> above first. After you have done so it's quite simple.</p>
<p>Open proxychains configuration file.</p>
<div class="codehilite"><pre><span class="n">kdesudo</span> <span class="n">leafpad</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">proxychains</span><span class="p">.</span><span class="n">conf</span>
</pre></div>
<p>Go to the bottom of the settings file. Comment out "<em>socks4 127.0.0.1 9050</em>" and add for example "<em>socks5 192.168.0.10 9152</em>" (for Tor stream isolation) or "<em>socks5 ip port</em>" with an IP and port of your choice to set the proxy settings. </p>
<div class="codehilite"><pre><span class="k">[ProxyList]</span>
<span class="c">## add proxy here ...</span>
<span class="c">## meanwhile</span>
<span class="c">## defaults set to &quot;tor&quot;</span>
<span class="c">#socks4 127.0.0.1 9050</span>
<span class="err">socks5</span> <span class="err">192.168.0.10</span> <span class="err">9152</span>
<span class="c"># socks5 x.x.x.x xxxx</span>
</pre></div>
<p>Advanced. Recommendation: Why not use Tor stream isolation for the proxychains connection?</p>
<div class="codehilite"><pre><span class="k">[ProxyList]</span>
<span class="c">## add proxy here ...</span>
<span class="c">## meanwhile</span>
<span class="c">## defaults set to &quot;tor&quot;</span>
<span class="c">#socks4 127.0.0.1 9050</span>
<span class="err">socks5</span> <span class="err">192.168.0.10</span> <span class="err">9152</span>
<span class="err">socks5</span> <span class="err">x.x.x.x</span> <span class="err">xxxx</span>
</pre></div>
<p>Safe the configuration file. Test afterwards. For example:</p>
<div class="codehilite"><pre><span class="n">proxychains</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">check</span><span class="p">.</span><span class="n">torproject</span><span class="p">.</span><span class="n">org</span>
</pre></div>
<p>Will do.</p>
<p>For testing, if you didn't disable the wget uwt wrapper, the following command will most likely get another IP. (Stream Isolation)</p>
<div class="codehilite"><pre><span class="c">## Using Tor's TransPort</span>
<span class="c">## (/usr/local/bin/wget uwt wrapper)</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">check</span><span class="p">.</span><span class="n">torproject</span><span class="p">.</span><span class="n">org</span>
</pre></div>
<h3 id="transparent-proxying">Transparent Proxying</h3>
<h4 id="introduction_1">Introduction</h4>
<p>To make clear, what this is about. Whonix-Gateway is already servering as a Transparent Proxy <font size="-3">(anonymizing middlebox)</font>, which means, that all applications not explicitly configured <font size="-3">(by uwt socksifier or proxy settings)</font> to use a SocksPort, can connect through Tor without any settings. The Transparent Proxying chapter on the <em>Tunnel Proxy/SSH/VPN through Tor</em> page is about configuring Whonix-Workstation also to act as a Transparent Proxy <font size="-3">(local redirection)</font>. Use case: a user wants to ensure all traffic goes through Tor (by using Whonix-Gateway) and want to additionally ensure, all traffic goes through a proxy choosen by the user behind Tor, i.e. user -&gt; Tor -&gt; proxy.</p>
<p><font size="-3"><a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorBOX/OptionalConfigurations?version=129#TransparentProxying" rel="nofollow">torproject.org wiki version 129</a> contains an old example using privoxy, JonDo and httpsdnsd. The new example uses redsocks and is simpler.</font></p>
<p>You always have to keep in mind, which kind of data and which kind of proxy you are using. There are CGIproxies, http(s) proxies and socks4/4a/5 proxies.</p>
<p>In case you redirect the network layer directly with iptables, you need a TransPort. Unfortunately very few applications, do offer a TransPort. For example, Tor supports a TransPort. In most other cases, you need to translate the different kinds of data.</p>
<p>Due to the nature of Transparent Proxying, we need to redirect with iptables and end up with a "Trans data stream". Because most proxies are either http or socks we need to translate this. Below we discuss a few tools which help here, not all are required, depending on what you want to do.</p>
<p>Required reading: </p>
<ul>
<li><a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/proxy" rel="nofollow">proxy</a></li>
<li><a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorPlusVPN" rel="nofollow">Tor Plus VPN or proxy</a></li>
</ul>
<h5 id="tools">Tools</h5>
<p>Tor is a socks proxy and also has a TransPort. Unfortunately, Tor can not be directly used as a http proxy. You must also keep in mind, that Tor does not support UDP, although it offers a DnsPort..</p>
<p><a class="" href="http://darkk.net.ru/redsocks/" rel="nofollow">redsocks</a> can also accept "Trans data streams" and can forward them to http<strong>s</strong>, socks4 and socks5 proxies. If you were to use a http proxy (no https, without connect-method, see proxy article), you could access only http sites, no https sites. Rather redsocks can convert UDP DNS queries to TCP DNS queries.</p>
<h5 id="dns-resolution">DNS resolution</h5>
<p>The complication (and also advantage/feature) with transparent proxying is, that the internet application (browser, etc.) is not aware of the proxy. Therefore the internet application will attempt to do the DNS resolution itself using the system, not using the proxy. The DNS requests also must be considered. Since Tor does not support UDP, we have to transmit DNS queries via TCP.</p>
<p>It is impossible to resolve DNS directly on the proxy, when using the proxy as a transparent proxy, see <a class="" href="https://sourceforge.net/p/whonix/wiki/Inspiration/#transparent-proxying-method">Transparent Proxying Method</a> for explanation. You need an extra DNS server, which answers over TCP.</p>
<p>You have several options to resolve DNS.</p>
<p>Either leave the setup as it is, Tor's DnsPort and therefore the Tor exit nodes will still do the DNS requests. (See DNS rule #1.) This is probable not what you want, since you wanted to cloak your identity with an additional proxy after Tor.</p>
<p>Alternatively you can use a public DNS resolver. The instructions for <a class="" href="https://sourceforge.net/p/whonix/wiki/OptionalConfigurations/#dnscrypt-by-opendns">DNSCrypt by OpenDNS</a>^4^ should work out of the box (tested). (See DNS rule #2.) (See footnotes ^1^, ^2^ and ^3^ if you are looking for other alternatives.)</p>
<p>Read the <a class="" href="https://sourceforge.net/p/whonix/wiki/Secondary%20DNS%20Resolver/">DNS related warnings</a>.</p>
<p><font size="-3"><br />
,,<br />
^1^ Also <a class="" href="https://sourceforge.net/p/whonix/wiki/OptionalConfigurations/#httpsdnsd-by-jondos">httpsdnsd by JonDos</a>^4^ might work, but you'd need to make some changes (use httpsdnsd as a system wide, Whonix-Workstation wide, DNS resolver, not just for a specific user account).<br />
^2^ Or perhaps also <a class="" href="http://www.mulliner.org/collin/ttdnsd.php" rel="nofollow">ttdnsd</a> with Google could work. All <a class="" href="https://en.wikipedia.org/wiki/Comparison_of_DNS_server_software" rel="nofollow">DNS resolvers</a> should work, as long TCP is supported and as long you are querying a TCP enabled DNS server.<br />
^3^ You can't simply add another public DNS resolver (i.e. OpenDNS or Google) to /etc/resolv.conf in Whonix-Workstation (i.e. Tor -&gt; public DNS resolver), it would have no effect, as explained under <a class="" href="https://sourceforge.net/p/whonix/wiki/Install%20Software/#whonix-workstation-is-firewalled">Whonix-Workstation is firewalled</a>.<br />
^4^ DNSCrypt and httpsdnsd add the advantage, that neither the proxy nor the Tor exit node can sniff or manipulate your DNS requests, since they are encrypted and authenticated.<br />
</font></p>
<h4 id="howto">HowTo</h4>
<p>Everything on Whonix-Workstation.</p>
<p>Get a working proxy and test if it works reliable.</p>
<p>Install redsocks.</p>
<div class="codehilite"><pre><span class="c">## Untested, easier. Please try and leave feedback.</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="n">install</span> <span class="n">redsocks</span>

<span class="c">## Or compile form git.</span>
<span class="c">#git clone https://github.com/darkk/redsocks.git</span>
<span class="c">## Build latest stable. 0.4 at time of writing. See</span>
<span class="c">## https://github.com/darkk/redsocks/tags for</span>
<span class="c">## most recent tag.</span>
<span class="c">#git tag -v &lt;version&gt;</span>
<span class="c">#compile...</span>
</pre></div>
<p>Config redsocks. TODO: share config. Shouldn't be hard to do oneself. See <a class="" href="https://github.com/darkk/redsocks/blob/master/debian/redsocks.conf" rel="nofollow">default config</a>. If you do, please share.</p>
<p>Add user redsocks.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">adduser</span> <span class="n">redsocks</span>
</pre></div>
<p>Start redsocks.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">redsocks</span> <span class="o">./</span><span class="n">redsocks</span>
</pre></div>
<p>Create a fw.sh and use this firewall rules.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">#!/bin/bash</span>
<span class="c">## These iptables rules redirect the traffic for all users,</span>
<span class="c">## including root, with the exception of the user redsocks,</span>
<span class="c">## through the proxy.</span>

<span class="c">## TODO: these iptables rules need review.</span>

<span class="c">## Choose either DNS rule #1 or DNS rule #2.</span>

<span class="c">## For debugging/testing use this command in console.</span>
<span class="c">## tail -f /var/log/syslog</span>

<span class="c">## Flush old rules.</span>
iptables -F
iptables -t nat -F
iptables -X

<span class="c">## Allow unlimited traffic on the loopback interface.</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
iptables -A OUTPUT --dst 127.0.0.1 -j ACCEPT

<span class="c">## Established incoming connections are accepted.</span>
iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

<span class="c">## Established outgoing connections are accepted.</span>
iptables -A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

<span class="c">## DNS rule #1.</span>
<span class="c">## Allow DNS directly through Whonix-Gateway.</span>
<span class="c">#iptables -A OUTPUT --dst 192.168.0.10 -p udp --dport 53 -j ACCEPT</span>

<span class="c">## DNS rule #2.</span>
<span class="c">## For DNSCrypt set /etc/resolv.conf to</span>
<span class="c">## nameserver 127.0.0.1</span>
<span class="c">##</span>
<span class="c">## sudo dnscrypt-proxy --tcp-only --user=user</span>
<span class="c">##</span>
<span class="c">## DNSCrypt listening on port 53</span>
iptables -t nat -A OUTPUT --dst 127.0.0.1 -p udp --dport 53 -j ACCEPT
iptables -t nat -A OUTPUT --dst 127.0.0.1 -p tcp --dport 53 -j ACCEPT

<span class="c">## redsocks must be allowed to establish direct connections.</span>
iptables -A OUTPUT -j ACCEPT -m owner --uid-owner redsocks
iptables -t nat -A OUTPUT -j ACCEPT -m owner --uid-owner redsocks

<span class="c">## Redirect remaining traffic to redsocks.</span>
iptables -t nat -A OUTPUT -p tcp -j REDIRECT --to-port 12345

<span class="c">## TODO: UDP rule untested.</span>
<span class="c">#iptables -t nat -A OUTPUT -p udp -j REDIRECT --to-port 10053</span>

<span class="c">## Log blocked traffic for debugging.</span>
iptables -A OUTPUT -j LOG --log-level 4 --log-prefix <span class="s2">&quot;iptables: &quot;</span>

<span class="c">## Reject all other traffic.</span>
iptables -A OUTPUT -j REJECT
</pre></div>
</td></tr></table>
<p>Make the firewall script executable.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">fw</span><span class="p">.</span><span class="n">sh</span>
</pre></div>
<p>Apply the firewall rules.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="o">./</span><span class="n">fw</span><span class="p">.</span><span class="n">sh</span>
</pre></div>
<h2 id="tunnel-ssh-through-tor">Tunnel SSH through Tor</h2>
<p><strong>user -&gt; Tor -&gt; SSH</strong></p>
<p>This chapter is not about connecting to a SSH server as a client (see Whonix in general and the Torify HOWTO). It is about adding an extra SSH tunnel after Tor.</p>
<p>Note, that even though SSH supports socks5, SSH is still not able to forward UDP on its own. Have a look the the <a class="" href="http://zarb.org/~gc/html/udp-in-ssh-tunneling.html" rel="nofollow">source</a> of that information. To summarize: to tunnel UDP over SSH client and shell admin need a special setup, which is for most shells, not going to happen.</p>
<p>A SSH tunnel will provide a local socks5 proxy. Create the SSH tunnel in the Whonix-Workstation. From there you'll end up with a local socks5 proxy. You can use this socks5 proxy following the proxy instructions above. Once the SSH tunnel is established, there are not many differences, besides the difference already clarified above about UDP and that the warning about missing encryption to the proxy does not apply to SSH tunnels, since SSH is encrypted. The SSH process needs to be allowed to access the internet directly, if you use transparent proxying, run the SSH process under an account, which is privileged to access the internet directly.</p>
<p>Another untested method may be <a class="" href="https://github.com/apenwarr/sshuttle" rel="nofollow">sshuttle</a>.</p>
<h2 id="tunnel-vpn-through-tor">Tunnel VPN through Tor</h2>
<p><strong>user -&gt; Tor -&gt; VPN</strong></p>
<h3 id="notes">Notes</h3>
<h4 id="udp">UDP</h4>
<p>Note, that you have to choose TCP transport, because Tor does not support UDP.</p>
<h4 id="using-transport-instead-of-socksport-is-required-for-tor-vpn">Using TransPort instead of SocksPort is required for Tor -&gt; VPN</h4>
<p>For applications configured to use SocksPort, instead of TransPort, which is the default setting for most Whonix default applications, such as <a class="" href="https://sourceforge.net/p/whonix/wiki/TorBrowser/">Tor Browser</a>...</p>
<p>SocksPort is configured for <a class="" href="https://sourceforge.net/p/whonix/wiki/Stream%20Isolation/">Stream Isolation</a>. As <a class="" href="https://trac.torproject.org/projects/tor/wiki/doc/TorPlusVPN" rel="nofollow">Tor Plus VPN or proxy</a> explains, you have to keep in mind, a VPN behind Tor adds a permanent exit node.</p>
<p>Rather, all applications, which are configured to use SocksPort, will not be tunneled through the VPN. They will be "only" tunneled through Tor. This is because, the VPN will not touch connections to <em>192.168.0.10</em>, which is the Whonix-Gateway. For example, if you wish to tunnel Tor Browser through Tor -&gt; VPN, you have to remove all proxy settings from Tor Browser, see <a class="" href="https://sourceforge.net/p/whonix/wiki/TorBrowser/#whonix-proxy-settings-userjs">Tor Browser Whonix Proxy Settings / user.js</a>. Check.torproject.org will tell you then "<em>You are not using Tor.</em>" and you'll see your VPN's IP. In fact your VPN was tunneled through Tor first. (Because Whonix-Workstation can not make any non-Tor connections by design, everything is tunneled over Tor.) When you stop your VPN for test reasons (<em>sudo /etc/init.d/openvpn stop</em>), it will show "<em>You are using Tor.</em>" again.</p>
<h4 id="vpn-breakdown">VPN breakdown</h4>
<p>VPN servers and VPN software can occasionally break down without announcement. Whonix-Workstation will seamlessly continue to make "direct" connections through Tor once the VPN breaks down. This is not a Whonix specific problem. It is a general problem with VPNs. Most users are simply not aware of it. This happens also with the common setup, where the VPN simply runs on a host. If you want to enforce, that the VPN is always tunneled through Tor, have to use a modified routing table. It is currently in development and help is welcome, see <a class="" href="https://sourceforge.net/p/whonix/wiki/VPN/">VPN</a>.</p>
<h4 id="vpn-and-stream-isolation">VPN and stream isolation</h4>
<p>While you are using a VPN behind Tor, you probable also may not be able to make use of the stream isolation feature ^1^, which is planed Tor Browser. This is because Tor Browser would not talk to Tor directly anymore. Tor Browser would connect to the VPN instead.</p>
<p><font size="-3"><br />
^1^ <a class="" href="https://trac.torproject.org/projects/tor/ticket/3455" rel="nofollow">Bug #3455: Tor Browser should set SOCKS username for a request based on referer</a><br />
</font></p>
<h4 id="identity-correlation">Identity correlation</h4>
<p>By design, a VPN routes all your applications (those without any proxy settings, as explained above) through the VPN. You may not want this, as explained above (<a class="alink" href="/p/whonix/wiki/Stream%20Isolation/">[Stream Isolation]</a>). To circumvent that, you should use this Whonix-Workstation only for the particular application you want to route through the VPN. You are advised to read <a class="" href="https://sourceforge.net/p/whonix/wiki/Multiple%20Whonix-Workstations/">Multiple Whonix-Workstations</a>.</p>
<h3 id="how">How</h3>
<p>Just use general instructions on doing so and of course do it inside Whonix-Workstation. Don't forget to read all the notes above. Since everything is routed through Tor, the VPN can be easily tunneled through Tor.</p>
<p>See also <a class="" href="https://sourceforge.net/p/whonix/wiki/TestVPN/">A Free example VPN working with Whonix for testing purposes</a>.</p>
<h1 id="footer">Footer</h1>
<div>
<div class="markdown_content"><p>This is a wiki. Want to improve this page? Contact us!</p>
<p><font size="-3">Unless otherwise noted above, content of this particular page is copyrighted by <a class="" href="mailto:adrelanos%20at%20riseup%20dot%20net">adrelanos</a> and licensed under the same Free (as in speech) license as Whonix itself.</font></p></div>
</div>
</div>

  <div id="create_wiki_page_holder" title="Create New Page" style="display:none">
    <form>
        <label class="grid-2">Name</label>
        <div class="grid-7"><input type="text" name="name"/></div>
    </form>
  </div>

          </div>
			
          
  <hr class="grid-19" style="margin-top: 1em; margin-bottom: 2em; clear:both;">
  
  
    <h4>Related</h4>
    <p>
    
      <a href="/p/whonix/wiki/Stream%20Isolation/">Wiki: Stream Isolation</a><br>
    
    </p>
  
  

        </div>
      </div>
    </section>
      
<footer id="site-footer">
    <div class="wrapper">
        <nav>
            <h5>SourceForge</h5>
            <a href="/about">About</a>
            <a href="/blog/category/sitestatus/">Site Status</a>
            <a href="http://twitter.com/sfnet_ops">@sfnet_ops</a>
        </nav>
        <nav>
            <h5>Find and Develop Software</h5>
            <a href="/create/">Create a Project</a>
            <a href="/directory/">Software Directory</a>
            <a href="/top">Top Downloaded Projects</a>
        </nav>
        <nav>
            <h5>Community</h5>
            <a href="/blog/">Blog</a>
            <a href="http://twitter.com/sourceforge">@sourceforge</a>
            <a href="/jobs?source=footer">Job Board</a>
        </nav>
        <nav>
            <h5>Help</h5>
            <a href="http://p.sf.net/sourceforge/docs">Site Documentation</a>
            <a href="/support">Support Request</a>
            <a href="http://p.sf.net/sourceforge/irc">Real-Time Support</a>
        </nav>
    </div>
</footer>
<footer id="site-copyright-footer">
    <div class="wrapper">
        <div id="copyright">
            Copyright &copy; 2013 SourceForge. All Rights Reserved.<br />
            SourceForge is a <a href="http://www.diceholdingsinc.com/phoenix.zhtml?c=211152&amp;p=irol-landing">Dice Holdings, Inc.</a> company.
        </div>
        <nav>
            <a href="http://slashdotmedia.com/terms-of-use">Terms</a>
            <a href="http://slashdotmedia.com/privacy-statement/">Privacy</a>
            <a href="http://slashdotmedia.com/opt-out-choices">Cookies/Opt Out</a>
            <a href="http://slashdotmedia.com">Advertise</a>
            <a href="http://sourceforge.jp/">SourceForge.JP</a>
        </nav>
    </div>
</footer>
    <div id="messages">
        
    </div>
    
      <!-- ew:body_js -->

    
      <script type="text/javascript" src="http://a.fsdn.com/allura/nf/1364319766/_ew_/_slim/js?href=allura%2Fjs%2Fjquery-base.js%3Ballura%2Fjs%2Fjquery.notify.js%3Ballura%2Fjs%2Fsylvester.js%3Ballura%2Fjs%2Fpb.transformie.min.js%3Ballura%2Fjs%2Fallura-base.js%3Bjs%2Fjquery.lightbox_me.js%3Bjs%2Fjquery.autosize-min.js%3Bjs%2Fjquery.textarea.js%3Bjs%2Fsf_markitup.js%3Bjs%2Fjquery.tagsinput.js"></script>
    
      
<!-- /ew:body_js -->

    
    
      <!-- ew:body_js_tail -->

    
      <script type="text/javascript">$(function () {
            var $lightbox = $('#lightbox_create_wiki_page');
            var $trigger = $('#sidebar a.add_wiki_page');
            $trigger.bind('click', function(e) {
                $lightbox.lightbox_me();
                return false;
            });
            $($lightbox).delegate('.close', 'click', function(e) {
                $lightbox.trigger('close');
                return false;
            });
        });
$(function () {
            $('#lightbox_create_wiki_page form').submit(function(){
                location.href = $('#sidebar a.add_wiki_page').attr('href') +
                    encodeURIComponent($('input[name=name]', $(this)).val().replace('/', '-')) + '/edit';
                return false;
            });
        });
$(function () {
            $('textarea.auto_resize').focus(function(){$(this).autosize();});
        });
$(document).ready(function () {
            $("a.attachment_form_add_button").click(function(evt){
                $(this).hide();
                $(".attachment_form_fields", this.parentNode).show();
                evt.preventDefault();
            });
            $("a.cancel_edit_post").click(function(evt){
                $("textarea", this.parentNode).val($("input.original_value", this.parentNode).val());
                $(".attachment_form_fields input", this.parentNode).val('');
                evt.preventDefault();
            });
         });

        (function () {
            $('div.discussion-post').each(function () {
                var post = this;
                $('.submit', post).button();
                $('.flag_post', post).click(function (ele) {
                    this.parentNode.submit();
                    return false;
                });
                $('.moderate_post', post).click(function(e){
                    e.preventDefault();
                    var mod = $(this).text();
                    var id_post = $(post).attr('id');
                    $.ajax({
                        type: 'POST',
                        url: this.parentNode.action,
                        data: jQuery(this.parentNode).serialize(),
                        success: function() {
                            if (mod == 'Delete'){
                                $(post).remove();
                            }
                            else if (mod == 'Approve'){
                                $('a.reply_post, a.shortlink, form.moderate_spam, form.moderate_approve', post).toggle();
                                $('div.moderate', post).removeClass('moderate');
                            }
                            else if (mod == 'Spam'){
                                $(post).remove();
                            }
                        }
                    });
                });

                if($('a.edit_post', post)){
                    $('a.edit_post', post).click(function (ele) {
                        $('.display_post', post).hide();
                        $('.edit_post_form', post).show();
                        $('.edit_post_form textarea', post).focus();
                        return false;
                    });
                    $("a.cancel_edit_post", post).click(function(evt){
                        $('.display_post', post).show();
                        $('.edit_post_form', post).hide();
                    });
                }
                if($('.reply_post', post)){
                    $('.reply_post', post).click(function (ele) {
                        $('.reply_post_form', post).show();
                        $('.reply_post_form textarea', post).focus();
                        return false;
                    });
                    $('.reply_post', post).button();
                }
                if($('.add_attachment', post)){
                    $('.add_attachment', post).click(function (ele) {
                        $('.add_attachment_form', post).show();
                        return false;
                    });
                }
                if($('.promote_to_thread', post)){
                    $('.promote_to_thread', post).click(function (ele) {
                        $('.promote_to_thread_form', post).show();
                        return false;
                    });
                }
                if($('.shortlink', post)){
                    var popup = $('.shortlink_popup', post);
                    $('.shortlink', post).click(function(evt){
                        evt.preventDefault();
                        popup.lightbox_me({
                            onLoad: function() {
                                $('input', popup).select();
                            }
                        });
                    });
                    $('.close', popup).bind('click', function() {
                        popup.hide();
                    });
                }
            });
        }());
        
$(function () {
            $('select.results_per_page').change(function () {
                this.form.submit();});});
$(function () {
          $('input.label_edit').tagsInput({
              'height':'100%',
              'width':'100%'
          });
        });

        $(document).ready(function () {
            var thread_tag = $('a.thread_tag');
            var thread_spam = $('a.sidebar_thread_spam');
            var tag_thread_holder = $('#tag_thread_holder');
            var allow_moderate = $('#allow_moderate');
            var mod_thread_link = $('#mod_thread_link');
            var mod_thread_form = $('#mod_thread_form');
            if (mod_thread_link.length) {
                if (mod_thread_form.length) {
                    mod_thread_link.click(function (e) {
                        mod_thread_form.show();
                        return false;
                    });
                }
            }
            if (thread_tag.length) {
                if (tag_thread_holder.length) {
                    var submit_button = $('input[type="submit"]', tag_thread_holder);
                    var cancel_button = $('<a href="#" class="btn link">Cancel</a>').click(function(evt){
                        evt.preventDefault();
                        tag_thread_holder.hide();
                        thread_tag.removeClass('active');
                    });
                    submit_button.after(cancel_button);
                    thread_tag.click(function (e) {
                        tag_thread_holder.show();
                        thread_tag.addClass('active');
                        // focus the submit to scroll to the form, then focus the subject for them to start typing
                        submit_button.focus();
                        $('input[type="text"]', tag_thread_holder).focus();
                        return false;
                    });
                }
            }
            if (thread_spam.length) {
                if (allow_moderate.length) {
                    var cval = $.cookie('_session_id');
                    thread_spam[0].style.display='block';
                }
            }
        });
        </script>
    
      
<!-- /ew:body_js_tail -->

    
    
  <div id="lightbox_create_wiki_page" class="modal" style="display:none">
  <b data-icon="D" class="ico ico-close close"></b>
  
    <h1>Add a Wiki Page</h1>
    <form class="grid-10">
        <label class="grid-2">Name</label>
        <div class="grid-7"><input type="text" name="name"></div>
        <label class="grid-2">&nbsp;</label>
        <div class="grid-7"><input type="submit" value="Create page"></div>
    </form>
  
</div>
<script type="text/javascript">
  /*<![CDATA[*/
  $('.post-link')
    .click(function(evt) {
        var cval = $.cookie('_session_id');
        evt.preventDefault();
        $.post(this.href, {_session_id:cval}, function(val)
            { window.location = val.location; },
            'json');
      });
  /*]]>*/
</script>
  

    
      
    
    
   
    
  </body>
</html>